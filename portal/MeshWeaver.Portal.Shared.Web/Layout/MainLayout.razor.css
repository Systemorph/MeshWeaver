@media (min-width: 768px) {
    #blazor-error-ui {
        background: var(--highlight-bg);
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
        color: var(--error-ui-foreground-color);
    }

    #blazor-error-ui a {
        color: var(--error-ui-accent-foreground-color);
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }

    #blazor-error-ui .reload {
        color: var(--error-ui-accent-foreground-color);
    }

    ::deep.layout {
        height: 100vh;
        width: 100vw;
        display: grid;
        grid-template-columns: auto 1fr;
        grid-template-rows: auto auto 1fr;
        grid-template-areas:
            "icon head"
            "nav messagebar"
            "nav main";
        background-color: var(--fill-color);
        color: var(--neutral-foreground-rest);
        transition: grid-template-columns 0.3s ease;
    }

    ::deep.layout.chat-visible.chat-right {
        --chat-width: 400px;
        grid-template-columns: auto 1fr var(--chat-width);
        grid-template-areas:
            "icon head head"
            "nav messagebar chat"
            "nav main chat";
    }

    ::deep.layout.chat-visible.chat-left {
        --chat-width: 400px;
        grid-template-columns: auto var(--chat-width) 1fr;
        grid-template-areas:
            "icon head head"
            "nav chat messagebar"
            "nav chat main";
    }

    ::deep.layout.chat-visible.chat-bottom {
        --chat-height: 300px;
        grid-template-columns: auto 1fr;
        grid-template-rows: auto auto 1fr var(--chat-height);
        grid-template-areas:
            "icon head"
            "nav messagebar"
            "nav main"
            "chat chat";
    }

    ::deep.layout>.meshweaver-icon {
        grid-area: icon;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--neutral-layer-4);
    }

    ::deep.layout>header {
        grid-area: head;
    }

    ::deep.layout>.fluent-appbar {
        grid-area: nav;
        overflow-y: auto;
        background: var(--neutral-layer-4);
    }

    ::deep.layout>.body-content {
        grid-area: main;
        overflow-x: auto;
        /* allow horizontal scrolling */
        overflow: auto;
        border-left: 1px solid var(--neutral-stroke-rest);
    }

    ::deep.layout>.messagebar-container {
        grid-area: messagebar;
        border-top: 1px solid var(--neutral-stroke-rest);
        border-left: 1px solid var(--neutral-stroke-rest);
    }

    ::deep .header-right {
        margin-left: auto;
    }

    ::deep.layout>header>.header-gutters>fluent-button[appearance=stealth]:not(:hover)::part(control),
    ::deep.layout>header>.header-gutters>fluent-anchor[appearance=stealth]:not(:hover)::part(control),
    ::deep.layout>header>.header-gutters>fluent-anchor[appearance=stealth].logo::part(control),
    ::deep.layout>.meshweaver-icon fluent-anchor[appearance=stealth].logo::part(control) {
        background-color: var(--neutral-layer-4);
    }

    ::deep.layout>header {
        background-color: var(--neutral-layer-4);
        margin-bottom: 0;
    }

    ::deep.layout>header>.header-gutters>fluent-anchor {
        font-size: var(--type-ramp-plus-2-font-size);
    }

    ::deep .meshweaver-icon fluent-anchor.logo::part(control) {
        padding: 0;
        border: none;
    }

    ::deep .meshweaver-icon fluent-anchor.logo,
    ::deep .meshweaver-icon fluent-anchor.logo::part(control),
    ::deep .meshweaver-icon fluent-anchor.logo::part(content) {
        height: 36px;
        width: 36px;
    }

    ::deep.layout>header>.header-gutters {
        margin-left: 0;
    }
}

@media (max-width: 768px) {
    #blazor-error-ui {
        background: var(--highlight-bg);
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
        color: var(--error-ui-foreground-color);
    }

    #blazor-error-ui a {
        color: var(--error-ui-accent-foreground-color);
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }

    #blazor-error-ui .reload {
        color: var(--error-ui-accent-foreground-color);
    }

    ::deep.layout {
        height: 100vh;
        width: 100vw;
        display: grid;
        grid-template-columns: auto 1fr;
        grid-template-rows: auto auto auto 1fr;
        grid-template-areas:
            "icon head"
            "nav-menu nav-menu"
            "messagebar messagebar"
            "main main";
        background-color: var(--fill-color);
        color: var(--neutral-foreground-rest);
    }

    /* Mobile bottom position */
    ::deep.layout.chat-visible.chat-bottom {
        --chat-height: 250px;
        grid-template-rows: auto auto auto 1fr var(--chat-height);
        grid-template-areas:
            "icon head"
            "nav-menu nav-menu"
            "messagebar messagebar"
            "main main"
            "chat chat";
    }

    ::deep.layout>.meshweaver-icon {
        grid-area: icon;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--neutral-layer-4);
    }

    ::deep.layout>header {
        grid-area: head;
    }

    ::deep.layout>.fluent-appbar {
        grid-area: nav;
        overflow-y: auto;
        background: var(--neutral-layer-4);
    }

    ::deep.layout>.body-content {
        grid-area: main;
        overflow-x: auto;
        /* allow horizontal scrolling */
        overflow: auto;
        border-left: 1px solid var(--neutral-stroke-rest);
    }

    ::deep.layout>.messagebar-container {
        grid-area: messagebar;
        border-top: 1px solid var(--neutral-stroke-rest);
        border-left: 1px solid var(--neutral-stroke-rest);
    }

    ::deep .header-right {
        margin-left: auto;
    }

    ::deep.layout>header>.header-gutters>fluent-button[appearance=stealth]:not(:hover)::part(control),
    ::deep.layout>header>.header-gutters>fluent-anchor[appearance=stealth]:not(:hover)::part(control),
    ::deep.layout>header>.header-gutters>fluent-anchor[appearance=stealth].logo::part(control),
    ::deep.layout>.meshweaver-icon fluent-anchor[appearance=stealth].logo::part(control) {
        background-color: var(--neutral-layer-4);
    }

    ::deep.layout>.meshweaver-icon {
        padding-left: 15px;
        background-color: var(--neutral-layer-4);
    }

    ::deep.layout>.meshweaver-icon fluent-anchor {
        margin-left: 5px;
    }

    ::deep.layout>.meshweaver-icon .navigation-button {
        border: 1px solid #a8aeb3;
    }

    ::deep.layout>header {
        background-color: var(--neutral-layer-4);
        margin-bottom: 0;
    }

    ::deep.layout>header>.header-gutters>fluent-anchor {
        font-size: var(--type-ramp-plus-2-font-size);
    }

    ::deep .meshweaver-icon fluent-anchor.logo::part(control) {
        padding: 0;
        border: none;
    }

    ::deep .meshweaver-icon fluent-anchor.logo,
    ::deep .meshweaver-icon fluent-anchor.logo::part(control),
    ::deep .meshweaver-icon fluent-anchor.logo::part(content) {
        height: 36px;
        width: 36px;
    }

    ::deep.layout>header>.header-gutters {
        margin-left: 0;
    }
}

::deep .desktop-nav-menu>.fluent-appbar-item>.fluentui-counterbadge-container>a>.stack-vertical {
    /* FluentAppBarItems have a default width. However, we have a wide range of widths
       in content depending on the language (ie, from traces to seguimientos).
       Remove the default horizontal padding to allow for more text  */
    padding-left: 0;
    padding-right: 0;
}

/* Desktop layout - Chat as part of grid */
@media (min-width: 768px) {
    .ai-chat-overlay {
        grid-area: chat;
        position: relative;
        background-color: transparent;
        pointer-events: auto;
        height: 100%;
        overflow: hidden;
        display: flex;
    }

    /* Right and left positioning use horizontal layout */
    .layout.chat-right .ai-chat-overlay,
    .layout.chat-left .ai-chat-overlay {
        flex-direction: row;
    }

    /* Bottom positioning uses vertical layout */
    .layout.chat-bottom .ai-chat-overlay {
        flex-direction: column;
        height: 100%;
    }

    /* Right position resizer */
    .layout.chat-right .ai-chat-resizer {
        width: 8px;
        height: 100%;
        background-color: var(--neutral-stroke-rest);
        cursor: col-resize;
        flex-shrink: 0;
        z-index: 2;
    }

    /* Left position resizer */
    .layout.chat-left .ai-chat-resizer {
        width: 8px;
        height: 100%;
        background-color: var(--neutral-stroke-rest);
        cursor: col-resize;
        flex-shrink: 0;
        z-index: 2;
        order: 1;
    }

    /* Bottom position resizer */
    .layout.chat-bottom .ai-chat-resizer {
        height: 8px;
        width: 100%;
        background-color: var(--neutral-stroke-rest);
        cursor: row-resize;
        flex-shrink: 0;
        z-index: 2;
    }

    /* Right position container */
    .layout.chat-right .ai-chat-container {
        flex: 1;
        height: 100%;
        background-color: var(--neutral-layer-1);
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
        display: flex;
        pointer-events: auto;
    }

    /* Left position container */
    .layout.chat-left .ai-chat-container {
        flex: 1;
        height: 100%;
        background-color: var(--neutral-layer-1);
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        display: flex;
        pointer-events: auto;
        order: 0;
    }

    /* Bottom position container */
    .layout.chat-bottom .ai-chat-container {
        flex: 1;
        width: 100%;
        background-color: var(--neutral-layer-1);
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        pointer-events: auto;
    }
}

/* Mobile layout - Chat as overlay */
@media (max-width: 767px) {
    .ai-chat-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1000;
        background-color: var(--neutral-layer-1);
        pointer-events: auto;
    }

    .ai-chat-container {
        position: relative;
        width: 100%;
        height: 100%;
        background-color: var(--neutral-layer-1);
        display: flex;
        pointer-events: auto;
    }

    .ai-chat-resizer {
        display: none;
    }
}

.ai-chat-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    height: 100%;
}

.ai-chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    border-bottom: 1px solid var(--neutral-stroke-rest);
    background-color: var(--neutral-layer-4);
    flex-shrink: 0;
    /* Prevent header from shrinking */
}

.ai-chat-header-controls {
    display: flex;
    gap: 5px;
}

/* Make Chat component take remaining space and be scrollable */
.ai-chat-content ::deep .message-list-container {
    overflow-y: auto;
    flex-grow: 1;
    height: calc(100% - 60px);
    /* Adjust based on header and chat input height */
    display: flex;
    flex-direction: column;
}

/* Ensure chat input stays at bottom */
.ai-chat-content ::deep .chat-container {
    flex-shrink: 0;
    padding-bottom: 10px;
}

/* Bottom position specific fixes */
.layout.chat-bottom .ai-chat-overlay {
    display: flex !important;
    flex-direction: column !important;
    height: var(--chat-height, 300px) !important;
    min-height: 200px !important;
    max-height: 70vh !important;
    position: relative !important;
    z-index: 10;
}

.layout.chat-bottom .ai-chat-resizer {
    display: block !important;
    height: 8px !important;
    width: 100% !important;
    cursor: row-resize !important;
    background-color: var(--neutral-stroke-rest) !important;
    flex-shrink: 0 !important;
    order: 0 !important;
    z-index: 11;
    position: relative;
}

.layout.chat-bottom .ai-chat-container {
    flex: 1 !important;
    width: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    order: 1 !important;
    background-color: var(--neutral-layer-1) !important;
    border-top: none !important;
    min-height: 0 !important;
    height: calc(100% - 8px) !important;
}

.layout.chat-bottom .ai-chat-content {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
    overflow: hidden !important;
    min-height: 200px !important;
}

/* Fix the actual chat structure - chat-app-container is the root */
.layout.chat-bottom .ai-chat-content ::deep .chat-app-container {
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
    min-height: 200px !important;
}

/* Chat header visibility */
.layout.chat-bottom .ai-chat-content ::deep .chat-header {
    flex-shrink: 0 !important;
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    background-color: var(--neutral-layer-4) !important;
    border-bottom: 1px solid var(--neutral-stroke-rest) !important;
    min-height: 50px !important;
    padding: 10px 15px !important;
    align-items: center !important;
    justify-content: space-between !important;
}

.layout.chat-bottom .ai-chat-content ::deep .chat-header .chat-title,
.layout.chat-bottom .ai-chat-content ::deep .chat-header .chat-actions {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.layout.chat-bottom .ai-chat-content ::deep .chat-header .chat-actions {
    display: flex !important;
    gap: 5px !important;
}

/* Chat main area - contains messages and input */
.layout.chat-bottom .ai-chat-content ::deep .chat-main-area {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    min-height: 150px !important;
    overflow: hidden !important;
}

/* Messages area - scrollable */
.layout.chat-bottom .ai-chat-content ::deep .chat-messages-area {
    flex: 1 !important;
    overflow-y: auto !important;
    min-height: 80px !important;
    padding: 10px !important;
}

/* Input container - always at bottom */
.layout.chat-bottom .ai-chat-content ::deep .chat-container {
    flex-shrink: 0 !important;
    padding: 12px !important;
    background-color: var(--neutral-layer-1) !important;
    border-top: 1px solid var(--neutral-stroke-rest) !important;
    min-height: 70px !important;
    max-height: 120px !important;
    display: block !important;
    position: relative !important;
    z-index: 2 !important;
}