@using Microsoft.Extensions.AI
@using MeshWeaver.AI

<div class="delegation-message">
    <div class="delegation-header" @onclick="ToggleExpanded">
        <div class="delegation-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 3M21 7.5H7.5" />
            </svg>
        </div>
        <div class="delegation-title">
            @if (DelegationContent.RequiresUserFeedback)
            {
                <span>Requesting feedback before delegating to <strong>@@@DelegationContent.TargetAgent</strong></span>
            }
            else
            {
                <span>Delegating to <strong>@@@DelegationContent.TargetAgent</strong></span>
            }
        </div>
        <div class="delegation-expand-icon @(isExpanded ? "expanded" : "")">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
            </svg>
        </div>
    </div>
    
    @if (isExpanded)
    {
        <div class="delegation-content">
            <div class="delegation-message-label">Message:</div>
            <div class="delegation-message-text">
                @DelegationContent.DelegationMessage
            </div>
            @if (DelegationContent.RequiresUserFeedback)
            {
                <div class="delegation-feedback-notice">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                    </svg>
                    Waiting for user input before proceeding with delegation
                </div>
            }
        </div>
    }
</div>

@code {
    private bool isExpanded = false;

    [Parameter, EditorRequired]
    public required ChatDelegationContent DelegationContent { get; set; }

    private void ToggleExpanded()
    {
        isExpanded = !isExpanded;
    }
}