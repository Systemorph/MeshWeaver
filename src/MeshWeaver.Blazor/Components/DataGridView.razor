@using System.Text.Json.Nodes
@using MeshWeaver.Layout.DataGrid
@inherits BlazorView<DataGridControl, DataGridView>

<div style="display: table; table-layout: fixed; width: 100%;" class="@Class">
    <div style="overflow-x: auto;">
        <FluentDataGrid Items="@QueryableData"
                        Virtualize="@virtualize"
                        ItemSize="@itemSize"
                        ResizableColumns="@resizableColumns"
                        GenerateHeader="@GetGenerateHeaderOption()"
                        GridTemplateColumns="@gridTemplateColumns"
                        Loading="@loading"
                        ShowHover="@showHover"
                        Pagination="@Pagination"
                        Style="@Style">
            @foreach (var column in ViewModel.Columns)
            {
                if(column is PropertyColumnControl propertyColumn)
                {
                    @((RenderFragment)(builder => RenderPropertyColumn(builder, propertyColumn)))
                }
                else if(column is TemplateColumnControl templateColumn)
                {
                    <TemplateColumn TGridItem="JsonObject" 
                                    Title="@GetTemplateColumnTitle(templateColumn)"
                                    Width="@GetTemplateColumnWidth(templateColumn)"
                                    Align="@GetTemplateColumnAlign(templateColumn)">
                        <CascadingValue Name="Context" Value="@context">
                            <DispatchView ViewModel="@templateColumn.Template" Stream="@Stream" Area="@Area"></DispatchView>
                        </CascadingValue>
                    </TemplateColumn>
                }
                else
                {
                    throw new NotImplementedException($"Column type {column.GetType().Name} is not supported.");
                }
            }
        </FluentDataGrid>
    </div>
</div>

<div class="paginator">
    @if (Pagination.TotalItemCount.HasValue && Pagination.TotalItemCount > Pagination.ItemsPerPage)
    {
        <FluentPaginator State="@Pagination"/>
    }
</div>


